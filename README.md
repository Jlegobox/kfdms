# KFDMS小型文件管理系统

### Welcome to visit source of KFDMS!

**GitHub地址：https://github.com/Jlegobox/kfdms**

**联系方式：jlc_game123@163.com**



### 项目简介

> KFDMS（Knowledge Flow Data Manage System）是一款完全开源的小型文件管理系统。可以帮助您快速搭建起一个面向家庭、团队或组织的文件管理系统。

![image-20210309134120472](https://i.loli.net/2021/03/09/zH69IWNw2PUpedr.png)

KFDMS开发的初衷是为了解决研究生课题组文件的保存和分享功能。研究生课题组是一个成员较多（多个老师及所带学生）并且成员变动频繁的一个组织。虽然大多数的研究资料，例如一些算法代码、数据集和各种书籍等，属于可重复利用、可传承的资料。但是由于学生进行的研究仅课题组内少数人员了解，并且大部分资料都保存在学生个人电脑中。因此为了资料更好的在实验室传承下去，本人着手开发了此项目并已部署在实验室服务器中，目前运行状况良好。

**当前版本：** v0.1内部测试



### 功能特性

系统提供**多文件多线程分片上传、断点续传、秒传功能，**保证大文件的上传顺利。

系统提供**多种文件分享模式**，满足多场景文件共享的需求，又保证私有文件不被窥探。

系统提供**邀请注册功能**，避免组织外人员注册。提供管理员权限管理用户登录。



### 环境依赖

**主要框架**

后端框架：SpringBoot+SpringMVC+Mybatis

前端框架：Layui+WebUploader

数据库使用MySql5.6.30版本

### 快速开始

#### **建立数据库相关表**

数据库表分为：

- user 用户信息表
- filenode 文件信息表
- folder 文件夹信息表
- fileshare_sharelog 文件分享记录表
- verification_log 邀请验证表

建表具体语句在`MasterDB.sql`文件中。



#### **修改配置**

在application.properties文件中修改数据库连接配置、文件上传大小配置和开启验证注册模式配置。

![image-20210309135619893](https://i.loli.net/2021/03/09/jWtzq2ydJc5AGlQ.png)



#### **注册用户**

输入`{host:port}`(本地用户且配置端口为8080，则输入`localhost:8080`)则自动跳转到登录页面。

![image-20210309140335825](https://i.loli.net/2021/03/09/WoRZxY6PvKhwGuQ.png)

点击注册，跳转到注册页面。根据配置项`sys.login.inviteMode`是否为1，确定是否开启邀请模式，**即是否必须使用验证码**。如果开启了邀请模式，则没有邀请码是无法注册的。

![image-20210309140657299](https://i.loli.net/2021/03/09/i683OZWUvXFStnV.png)

**普通用户注册**

- 没有开启邀请模式，则按照要求输入**邮箱（唯一身份认证）**和密码进行注册登录。注册的身份为**普通用户**。
- 开启验证码模式，则输入邀请码。系统会记录您是谁邀请注册的用户。

**管理员用户注册**

- 登录MySql系统并执行以下代码，获取邀请码。

  ```sql
  use kfdms;
  select verification_code from verification_log where verification_owner=-1;
  ```

  ![image-20210309141336759](https://i.loli.net/2021/03/09/acdS8vopGmxWFTy.png)

  根据此邀请码注册的用户为管理员用户。

### **功能介绍**

管理员权限相对于普通用户权限，多了管理员菜单的功能。因此不特别做说明的，即为通用功能。

![image-20210309142115760](https://i.loli.net/2021/03/09/qibptBmyKERefdx.png)

用户登录后即可看到下图页面，功能主要分为：

- 个人云盘。

  包括上传下载文件，分享文件，管理文件等功能。

- 个人中心

  个人信息的修改，密码修改和用户注销等。

- 文件广场

  对于用户公开的文件，进行展示。在这里可以看到每个用户的公开文件，寻找需要的资料。

- 管理员菜单

  查看并管理系统的所有用户。



#### 个人云盘

##### **我的文件**

​		我的文件展示了所有上传的文件。提供目录方式的文件管理功能。配合前端插件`WebUploader`实现多线程单文件上传和多文件上传功能。并且可以对需要分享的文件生成文件分享连接，方便文件的分享。

​		**新建文件夹**

​		新建文件夹的文件夹除了名称外，可以选择共享类型和文件夹描述。共享类型默认为私有，公有的文件夹可以在文件广场中被其他用户访问。

![image-20210309143415211](C:%5CUsers%5CJ%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210309143415211.png)

​		**上传文件**

​		上传文件可以同时选择多个文件进行上传。单个文件的上传失败不会影响其他文件的上传。

​		秒传功能。上传过的文件再次上传时，不会持续等待原来那么久时间。文件解析完成后，一秒钟上传完成。

![image-20210309143659774](https://i.loli.net/2021/03/09/iWbCcDK3Xlge1QO.png)

​		**属性编辑**

​		文件夹和文件在更多操作按钮中，都可以选择编辑进行可选属性的编辑。

![image-20210309150853924](https://i.loli.net/2021/03/09/iOp2WExfDQA1Y7M.png)

**文件分享**

可参考百度网盘的分享功能。

点击文件或文件夹的分享按钮，出现分享菜单。点击创建连接，生成分享连接。链接的分享不论文件/文件夹的私有、公开属性。

![image-20210309150947022](https://i.loli.net/2021/03/09/dlcbmZfSjpBe8xt.png)

![image-20210309151332880](https://i.loli.net/2021/03/09/LyBJgEuXMcb3spt.png)

##### 我的分享

在我的分享中，可以看到分享的所有文件链接并维护这些链接。

![image-20210309151522478](https://i.loli.net/2021/03/09/XtMCKx42nYjaLRW.png)

#### 个人中心

个人中心中，分为我的账号、修改密码、账号注销。

我的账号中，在第一次登录后，需要修改各类可以修改的信息。并且展示了我的用户类型和注册时使用的邀请码。

邀请码部分为我的邀请码，我可以分享此邀请码供他人注册。

点击刷新邀请码按钮会刷新邀请码，老的邀请码便不再提供注册权限。

![image-20210309151704175](https://i.loli.net/2021/03/09/96pB2xkHS8NQFUE.png)

#### 文件分享

文件分享目前主要有两大方式，一种是分享链接的方式，另一种就是文件广场的方式。

##### 分享链接

如何创建分享链接前文已经提过，这里展示分享链接的验证逻辑。

- 1、复制分享链接到浏览器，进入验证界面。输入验证码。

  ![image-20210309152300488](https://i.loli.net/2021/03/09/iyKGltkQzwfVYA3.png)

- 2、点击提取文件。如果用户还未登录系统，则会要求用户进行登录。

  ![image-20210309152517550](https://i.loli.net/2021/03/09/yGaceSpb7LVBIYr.png)

- 登录后，即可进入分享页面进行下载或保存操作。

![image-20210309152617132](https://i.loli.net/2021/03/09/rMItL6Q1lZybVzu.png)

##### 文件广场

点击文件广场，可以看到如下界面：

![image-20210309153045040](https://i.loli.net/2021/03/09/mNznZhCJrcid3fI.png)

root目录下每个文件夹表示一个用户，文件夹的名称即为用户名称。

点击进入admin文件夹可以发现之前公开的文件和文件夹都出现在页面中。但是当时创建的私有文件夹就没有权限访问了。使用时每个用户应当创建一个公开文件夹专门用于分享文件。

在此页面中，用户只对文件有下载、预览和保存的权限。

![image-20210309153201200](https://i.loli.net/2021/03/09/QEiCMTsX1Iyo8Au.png)

#### 管理员菜单

管理员菜单是管理员才可以访问的菜单，目前仅有用户管理功能。

管理员可以点击左上角按钮开启或关闭邀请模式。也可以点击每个用户最后一栏按钮，禁止部分用户登录。被禁止的用户不能再登录此系统。

![image-20210309153454615](https://i.loli.net/2021/03/09/NyqzLCt6e9c2SP1.png)

### 目录结构描述

- `com.mp.kfdms.annotation.*` 自定义注解
- `com.mp.kfdms.configuration.*`配置类，相关配置以及`ConfigurationReader`类实现配置管理
- `com.mp.kfdms.controller.*` 跳转控制器
- `com.mp.kfdms.customArgumentResolver.*` 自定义参数解析类
- `com.mp.kfdms.domain.*` 数据库实体类
- `com.mp.kfdms.mapper.*`数据库操控类接口
- `com.mp.kfdms.pojo.*`各类定义的数据结构类
- `com.mp.kfdms.service.*`服务类
- `com.mp.kfdms.util.*`工具类
- `resources\mybatisResources\mapper\*` mybatis对应的mapper.xml



### TODO LIST

- 断点下载功能
- 暴露各类可设置参数，统一到管理员菜单，通过前端进行设置
- 注册时邮箱验证功能
- 生成注册邀请链接，仅供一人注册

### 声明

本项目由个人独立完成，完全开源，任何人或组织可以根据[MIT License](https://choosealicense.com/licenses/mit/)进行下载使用并进行重构。项目前端借鉴了x-admin开源后台管理模板。因为精力有限，本项目目前仍为测试版本而不是正式可发布版本。如果有找到任何bug或修改建议，欢迎邮件联系(jlc_game123@163.com)。欢迎同道共同讨论和开发。

### 协议

[MIT License](https://choosealicense.com/licenses/mit/)